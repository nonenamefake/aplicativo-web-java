<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechGear - Carrito de Compras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/CarritoCompras.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKx3nfrFqUIfy/S1n/R+6yBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="/">
                    <img src="/images/techGear.png" alt="Logo de TechGear" class="d-inline-block align-text-top me-2 w-50 h-50">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/TerminosCondiciones">Terminos y condiciones</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/politicas">Politica de privacidad</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Find">Productos</a> <!-- Enlace actualizado para la nueva sección -->
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Carrito">Carrito</a>
                        </li>
                        <!-- Login / User dropdown -->
                        <!-- show login button when NOT authenticated as a client (ROLE_USER) -->
                        <li class="nav-item" sec:authorize="!hasRole('USER')">
                            <a class="btn btn-outline-light ms-2" href="/Login">
                                <i class="fas fa-sign-in-alt me-1"></i>Iniciar Sesión
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="!hasRole('USER')">
                            <a class="btn btn-outline-light ms-2" href="/Registrar">
                            <i class="fas fa-sign-in-alt me-1"></i>Registrar
                            </a>
                        </li>

                        <!-- show user dropdown only when authenticated as a client -->
                        <li class="nav-item dropdown" sec:authorize="hasRole('USER')">
                            <a class="nav-link dropdown-toggle btn btn-outline-secondary" type="button" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user me-1" ></i>
                                <span th:text="${currentUser != null ? currentUser.firstName : #authentication.name}">Usuario</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li><a class="dropdown-item" th:if="${currentUser != null}" th:href="@{/mi-cuenta}">Cuenta</a></li>
                                <li><a class="dropdown-item" th:if="${currentUser != null}" th:href="@{/Orders}">Compras</a></li>
                                <li>
                                    <form th:action="@{/logout}" method="post" style="margin:0">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button type="submit" class="dropdown-item">Cerrar sesión</button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <section class="shopping-cart dark">
        <div class="container">
            <div class="block-heading">
                <h2>Carrito de compras</h2>
                <p th:if="${carrito == null}" class="text-muted">No hay productos en el carrito</p>
            </div>
            <div class="content" th:if="${carrito != null}">
                <div class="row">
                    <div class="col-md-12 col-lg-8">
                        <div class="items">
                            <!-- Mensaje si el carrito está vacío -->
                            <div th:if="${productos == null or productos.isEmpty()}" class="alert alert-info">
                                <i class="fas fa-shopping-cart me-2"></i>Tu carrito está vacío. 
                                <a href="/Find" class="alert-link">Explorar productos</a>
                            </div>

                            <!-- Lista de productos del carrito -->
                            <div th:each="carritoProducto : ${productos}" class="product" th:if="${productos != null and !productos.isEmpty()}">
                                <div class="row">
                                    <div class="col-md-3" >
                                        <!-- Imagen del producto -->
                                        <img th:if="${carritoProducto.product != null and carritoProducto.product.images != null and !carritoProducto.product.images.isEmpty()}" 
                                             th:src="${carritoProducto.product.images[0].url}" 
                                             class="img-fluid mx-auto d-block image" 
                                              style="width: 100px; height: 100px; object-fit: cover;" 
                                             th:alt="${carritoProducto.product.name}">
                                    </div>
                                    <div class="col-md-8">
                                        <div class="info" style="padding: 0;">
                                            <div class="row">
                                                <div class="col-md-4 product-name" style="padding: 0;">
                                                    <div class="product-name">
                                                        <a th:href="@{/Verproducto/{id}(id=${carritoProducto.product.id})}" 
                                                           th:text="${carritoProducto.product != null ? carritoProducto.product.name : 'Producto'}">
                                                            Nombre del Producto
                                                        </a>
                                                        <div class="product-info" th:if="${carritoProducto.product != null}">
                                                            <div th:if="${carritoProducto.product.category != null}">
                                                                Categoría: <span class="value" th:text="${carritoProducto.product.category}">Categoría</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2 quantity" style="padding: 0;">
                                                    <label for="quantity">Cantidad:</label>
                                                        <form th:action="@{/Carrito/actualizar-cantidad/{id}(id=${carritoProducto.idCarritoProducto})}" 
                                                            method="post" 
                                                            class="d-inline">
                                                          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                                        <input type="number" 
                                                               name="cantidad" 
                                                               th:value="${carritoProducto.cantidad}" 
                                                               min="1" 
                                                               th:max="${carritoProducto.product != null ? carritoProducto.product.stock : 999}"
                                                               class="form-control quantity-input"
                                                               onchange="this.form.submit()">
                                                    </form>
                                                </div>
                                                <div class="col-md-4 price" style="margin-top: 0;">
                                                    <label for="quantity">Precio:</label>
                                                    <span th:text="${'S/' + #numbers.formatDecimal(carritoProducto.product != null ? (carritoProducto.product.price * carritoProducto.cantidad) : 0, 1, 2)}">
                                                        S/0.00
                                                    </span>
                                                </div>
                                                <div class="col-md-2 eliminar" style="margin-top: 17px;">
                                                        <form th:action="@{/Carrito/eliminar/{id}(id=${carritoProducto.idCarritoProducto})}" 
                                                            method="post" 
                                                            class="mt-2">
                                                          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                                        <button type="submit" class="btn btn-sm btn-danger">
                                                            <i class="fas fa-trash"></i> Eliminar
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-lg-4">
                        <div class="summary">
                            <h3>Resumen</h3>
                            <div class="summary-item">
                                <span class="text">Subtotal:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(subtotal, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">Descuento:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(descuento, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">IGV (18%):</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(igv, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">Total:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(total, 1, 2)}">S/ 0.00</span>
                            </div>
                            <a th:href="@{/PasarelaPagos}" class="btn btn-primary btn-lg btn-block" th:classappend="${productos == null or productos.isEmpty()} ? ' disabled' : ''" role="button">
                                <i class="fas fa-credit-card me-2"></i>Comprar
                            </a>
                            <a th:href="@{/Find}" class="btn btn-secondary btn-lg btn-block">
                                <i class="fas fa-arrow-left me-2"></i>Seguir Comprando
                            </a>
                            <form th:if="${carrito != null}" th:action="@{/Carrito/cancelar/{id}(id=${carrito.id})}" method="post" class="mt-2">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="btn btn-danger btn-lg btn-block">
                                    <i class="fas fa-times me-2"></i>Cancelar Carrito
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-primary mt-auto py-5 pb-2 footer-custom text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Enlaces Importantes</h5>
                    <ul class="list-unstyled">

                        <li class="mb-2"><a href="/TerminosCondiciones" class="text-decoration-none text-white">Términos y Condiciones</a></li>
                        <li class="mb-2"><a href="/politicas" class="text-decoration-none text-white">Política de Privacidad</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Libro de Reclamaciones</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Enlaces Rápidos</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Nosotros</a></li>

                        <li class="mb-2"><a href="/Contacto" class="text-decoration-none text-white">Contácto</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Ver productos</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Contáctanos</h5>
                    <p class="text-white mb-1 small">
                        Para estado de pedidos o problemas de entrega, escríbenos a: <br>
                        <a href="mailto:contacto@techgear.com" class="text-decoration-none text-white">contacto@techgear.com</a>
                    </p>


                    <p class="text-white small">Atencion: Lun - Vie 10 AM - 6 PM <br>Sáb: 10:00 - 15:00</p>

                    <p class="text-white mb-1 small">
                        Cambios y Reemplazos: <br>
                        <a href="#" class="text-decoration-none text-white fw-bold">Solicitar aquí</a>
                    </p>

                    <p class="text-white small fst-italic">Nota: Las solicitudes deben hacerse dentro de los 7 días de la entrega.</p>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Sé Parte de TechGear</h5>
                    <p class="text-white small">Únete para obtener 10% de descuento en tu primera compra y las últimas novedades y ofertas.</p>
                    
                    <form class="input-group mb-3">
                        <input type="email" class="form-control" placeholder="Introduce tu email" aria-label="Introduce tu email">
                        <button class="btn btn-outline-primary" type="submit">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>

                    <div class="social-icons mt-3 text-center">
                        <a href="#" class="text-white me-3"><i class="bi bi-facebook fa-lg fs-4"></i></a>
                        <a href="#" class="text-white me-3"><i class="bi bi-instagram fa-lg mx-3 fs-4"></i></a>
                        <a href="#" class="text-white me-3"><i class="bi bi-tiktok fa-lg fs-4"></i></a>
                    </div>
                </div>
            </div>

            <hr class="mt-4 mb-3 border-secondary-subtle"> 
            
            <div class="row align-items-center ">
                <div class="container text-center">
                    <p class="mb-2">&copy; 2023 TechGear. Todos los derechos reservados. </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="../static/JavaScript/Login.js"></script>
</body>
</html>