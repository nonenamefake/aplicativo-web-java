<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pasarela de Pagos</title>
    <!-- Bootstrap 5 CDN -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"  crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>
  <body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="/">
                    <img src="/images/techGear.png" alt="Logo de TechGear" class="d-inline-block align-text-top me-2 w-50 h-50">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/TerminosCondiciones">Terminos y condiciones</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/politicas">Politica de privacidad</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Find">Productos</a> <!-- Enlace actualizado para la nueva secci칩n -->
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/Carrito">Carrito</a>
                        </li>
                        <!-- Login / User dropdown -->
                        <!-- show login button when NOT authenticated as a client (ROLE_USER) -->
                        <li class="nav-item" sec:authorize="!hasRole('USER')">
                            <a class="btn btn-outline-light ms-2" href="/Login">
                                <i class="fas fa-sign-in-alt me-1"></i>Iniciar Sesi칩n
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="!hasRole('USER')">
                            <a class="btn btn-outline-light ms-2" href="/Registrar">
                            <i class="fas fa-sign-in-alt me-1"></i>Registrar
                            </a>
                        </li>

                        <!-- show user dropdown only when authenticated as a client -->
                        <li class="nav-item dropdown" sec:authorize="hasRole('USER')">
                            <a class="nav-link dropdown-toggle btn btn-outline-secondary" type="button" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user me-1" ></i>
                                <span th:text="${currentUser != null ? currentUser.firstName : #authentication.name}">Usuario</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li><a class="dropdown-item" th:if="${currentUser != null}" th:href="@{/mi-cuenta}">Cuenta</a></li>
                                <li><a class="dropdown-item" th:if="${currentUser != null}" th:href="@{/Orders}">Compras</a></li>
                                <li>
                                    <form th:action="@{/logout}" method="post" style="margin:0">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button type="submit" class="dropdown-item">Cerrar sesi칩n</button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
      <div class="payment-card card shadow-sm">
        <div class="card-body">
          <h3 class="card-title mb-3">Pagar producto</h3>

          <div class="row">
            <!-- FORM -->
                        <div class="col-md-7">
                            <form id="checkout-form" th:action="@{/orders/create}" method="post" novalidate>
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="mb-3">
                  <label for="name" class="form-label">Nombre del titular</label>
                  <input type="text" class="form-control" id="name" placeholder="Nombre completo" required>
                  <div class="invalid-feedback">Ingresa el nombre del titular.</div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Datos de la tarjeta</label>
                  <!-- DEMO: campos simples. Para producci칩n, usar Stripe Elements o tokenizaci칩n. -->
                                    <div class="input-group mb-2">
                                        <input type="text" name="cardNumber" class="form-control" id="card-number" placeholder="N칰mero de tarjeta" maxlength="19" required>
                                        <span class="input-group-text card-icon">游눱</span>
                                        <div class="invalid-feedback">Ingresa un n칰mero de tarjeta v치lido.</div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <input type="text" name="cardExp" class="form-control" id="card-exp" placeholder="MM/AA" maxlength="5" required>
                                        <input type="text" name="cardCvc" class="form-control" id="card-cvc" placeholder="CVC" maxlength="4" required>
                                    </div>
                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label">Correo electr칩nico</label>
                                    <input type="email" name="email" class="form-control" id="email" placeholder="tucorreo@ejemplo.com" required>
                                    <div class="invalid-feedback">Ingresa un correo v치lido.</div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">Direcci칩n (opcional)</label>
                                    <input type="text" name="address" class="form-control" id="address" placeholder="Direcci칩n">
                                </div>

                <div class="mb-3 form-check">
                  <input type="checkbox" class="form-check-input" id="save-card">
                  <label class="form-check-label" for="save-card">Guardar m칠todo de pago (demo)</label>
                </div>

                <button id="pay-button" type="submit" class="btn btn-primary w-100">Pagar ahora</button>

                <small class="d-block text-muted mt-2">Nota: este formulario es una plantilla de front-end. Para cumplir PCI DSS, no captures ni env칤es n칰meros de tarjeta sin tokenizaci칩n (ej. Stripe, PayPal).</small>
              </form>
            </div>

            <!-- RESUMEN -->
            <div class="col-md-5 border-start ps-4">
              <h5>Resumen de compra</h5>
                  <div class="col-md-12 col-lg-4">
                        <div class="summary">
                            <div class="summary-item">
                                <span class="text">Subtotal:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(subtotal, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">Descuento:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(descuento, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">IGV (18%):</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(igv, 1, 2)}">S/ 0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="text">Total:</span>
                                <span class="price" th:text="${'S/ ' + #numbers.formatDecimal(total, 1, 2)}">S/ 0.00</span>
                            </div>
                        </div>
                    </div>



              <!-- CONTENEDOR QR -->
              <div id="qr-box" class="text-center p-3 border rounded d-none">
                <h6 id="qr-title">Escanea para pagar</h6>
                <img id="qr-img" src="" alt="QR" class="img-fluid" style="max-width:180px;">
                <p class="mt-2 small text-muted">El pago se validar치 autom치ticamente.</p>
                <button class="btn btn-sm btn-secondary mt-2" id="btn-cancel-qr">Cancelar</button>
              </div>

              <div id="status" class="small text-success mt-2"></div>
            </div>
          </div>
        </div>
      </div>

      
    </div>
    <footer class="bg-primary mt-auto py-5 pb-2 footer-custom text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Enlaces Importantes</h5>
                    <ul class="list-unstyled">

                        <li class="mb-2"><a href="/TerminosCondiciones" class="text-decoration-none text-white">T칠rminos y Condiciones</a></li>
                        <li class="mb-2"><a href="/politicas" class="text-decoration-none text-white">Pol칤tica de Privacidad</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Libro de Reclamaciones</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Enlaces R치pidos</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Nosotros</a></li>

                        <li class="mb-2"><a href="/Contacto" class="text-decoration-none text-white">Cont치cto</a></li>
                        <li class="mb-2"><a href="#" class="text-decoration-none text-white">Ver productos</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">Cont치ctanos</h5>
                    <p class="text-white mb-1 small">
                        Para estado de pedidos o problemas de entrega, escr칤benos a: <br>
                        <a href="mailto:contacto@techgear.com" class="text-decoration-none text-white">contacto@techgear.com</a>
                    </p>


                    <p class="text-white small">Atencion: Lun - Vie 10 AM - 6 PM <br>S치b: 10:00 - 15:00</p>

                    <p class="text-white mb-1 small">
                        Cambios y Reemplazos: <br>
                        <a href="#" class="text-decoration-none text-white fw-bold">Solicitar aqu칤</a>
                    </p>

                    <p class="text-white small fst-italic">Nota: Las solicitudes deben hacerse dentro de los 7 d칤as de la entrega.</p>
                </div>

                <div class="col-md-3 col-sm-6 mb-4">
                    <h5 class="fw-bold mb-3">S칠 Parte de TechGear</h5>
                    <p class="text-white small">칔nete para obtener 10% de descuento en tu primera compra y las 칰ltimas novedades y ofertas.</p>
                    
                    <form class="input-group mb-3">
                        <input type="email" class="form-control" placeholder="Introduce tu email" aria-label="Introduce tu email">
                        <button class="btn btn-outline-primary" type="submit">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>

                    <div class="social-icons mt-3 text-center">
                        <a href="#" class="text-white me-3"><i class="bi bi-facebook fa-lg fs-4"></i></a>
                        <a href="#" class="text-white me-3"><i class="bi bi-instagram fa-lg mx-3 fs-4"></i></a>
                        <a href="#" class="text-white me-3"><i class="bi bi-tiktok fa-lg fs-4"></i></a>
                    </div>
                </div>
            </div>

            <hr class="mt-4 mb-3 border-secondary-subtle"> 
            
            <div class="row align-items-center ">
                <div class="container text-center">
                    <p class="mb-2">&copy; 2023 TechGear. Todos los derechos reservados. </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Optional: Stripe.js integration skeleton (replace PUBLIC_KEY) -->
    <!--
    <script src="https://js.stripe.com/v3/"></script>
    -->

    <!-- App scripts: primero nuestro c칩digo (definido dentro de DOMContentLoaded), luego Bootstrap -->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // client-side minimal validation for required fields
            document.addEventListener('DOMContentLoaded', function(){
                const form = document.getElementById('checkout-form');
                if (!form) return;
                form.addEventListener('submit', function(e){
                    const name = document.getElementById('name');
                    const email = document.getElementById('email');
                    if (!name || !email) return;
                    if (name.value.trim() === '' || email.value.trim() === '') {
                        e.preventDefault();
                        alert('Por favor completa los campos requeridos: Nombre y Correo');
                        return false;
                    }
                    // here you could optionally run further validation or tokenization
                    return true;
                });
            });
        </script>
  </body>
</html>
