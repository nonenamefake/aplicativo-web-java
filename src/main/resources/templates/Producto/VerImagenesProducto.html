<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Gestión de Imágenes - Producto</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:400,700"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/AdminLogos.css">
    <link rel="stylesheet" href="/css/bootstrap-admin.css">
    <link rel="stylesheet" href="/css/templatemo-style-admin.css">
    <link rel="stylesheet" href="/css/AdminCuentas.css">
  </head>
  <body id="reportsPage">
    <div class="" id="home">
      <nav class="navbar navbar-expand-xl">
        <div class="container h-100">
            <h1 class="tm-site-title mb-0">Administrador de productos</h1>


          <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars tm-nav-icon"></i>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto h-100">
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="far fa-file-alt"></i>
                    <span>
                      Informe <i class="fas fa-angle-down"></i>
                    </span>
                </a>
                    
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/Verorder">Order usuario</a>
                  <a class="dropdown-item" href="/Consultas">Consultas</a>
                </div>
              </li>

              <li class="nav-item">
                <a class="nav-link active" href="/producto">
                  <i class="fas fa-shopping-cart"></i>
                    Productos
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link " href="/usuario">
                  <i class="far fa-user"></i>
                    Usuarios
                </a>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="/empleado"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-cog"></i>
                    Empleado 
                </a>
              </li>
            </ul>
                
            <ul class="navbar-nav">
              <li class="nav-item">
                <form th:action="@{/logoutemp}" method="post" style="margin:0">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="dropdown-item">Cerrar sesión</button>
                </form>
              </li>
            </ul>
          </div>
        </div>
      </nav>
        <!-- table-forme start ---------------------------------->
    <div class="container" style="margin: 30px auto auto;">
        <div class="row mb-4">
            <div class="col-md-12">
                <h2 class="mb-3">Imágenes del Producto: <span th:text="${producto.name}"></span></h2>
                <a th:href="@{/producto}" class="btn btn-secondary">Volver a Productos</a>
            </div>
        </div>
        
        <!-- Mensajes de éxito/error -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        
        <!-- Formulario para subir imagen -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-upload me-2"></i>Subir Nueva Imagen</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/producto/imagenes/{id}/subir(id=${producto.id})}" method="post" enctype="multipart/form-data">
                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <div class="mb-3">
                        <label for="file" class="form-label">Seleccionar Imagen</label>
                        <input type="file" class="form-control" id="file" name="file" accept="image/*" required>
                        <div class="form-text">Formatos permitidos: JPG, PNG, GIF</div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload me-2"></i>Subir Imagen
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Galería de imágenes -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-images me-2"></i>Imágenes del Producto</h5>
            </div>
            <div class="card-body">
                <div th:if="${imagenes == null || imagenes.isEmpty()}" class="alert alert-info">
                    No hay imágenes para este producto. Sube una imagen para comenzar.
                </div>
                <div th:if="${imagenes != null && !imagenes.isEmpty()}" class="row">
                    <div th:each="imagen, iterStat : ${imagenes}" class="col-md-4 mb-4">
                        <div class="card">
                            <img th:src="${imagen.url}" class="card-img-top" style="height: 250px; object-fit: cover;" alt="Imagen del producto">
                            <div class="card-body">
                                <p class="card-text"><small class="text-muted">URL: <span th:text="${imagen.url}"></span></small></p>
                                <p class="card-text"><small class="text-muted">Orden: <span th:text="${imagen.displayOrder}"></span></small></p>
                                <a th:href="@{/producto/imagenes/{productId}/eliminar/{imageId}(productId=${producto.id}, imageId=${imagen.id})}" 
                                   class="btn btn-danger btn-sm"
                                   onclick="return confirm('¿Está seguro de eliminar esta imagen?')">
                                    <i class="fas fa-trash me-1"></i>Eliminar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- table-forme end ---------------------------------->

    </div>
        <footer class="tm-footer row tm-mt-small">
          <div class="col-12 font-weight-light">
              <p class="text-center text-white mb-0 px-4 small">
                &copy; <b>2023</b> TechGear. Todos los derechos reservados.
              </p>
          </div>
        </footer>
    </div>

    <script src="/JavaScript/jquery-3.3.1.min.js"></script>
    <script src="/JavaScript/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

